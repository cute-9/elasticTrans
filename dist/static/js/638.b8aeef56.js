"use strict";(self["webpackChunkproject_01"]=self["webpackChunkproject_01"]||[]).push([[638],{4638:function(e,t,i){i.r(t),i.d(t,{default:function(){return b}});var s=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"content"},[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.btnClick("add")}}},[t("i",{staticClass:"el-icon-circle-plus-outline"}),e._v(" 新增")]),t("el-table",{staticClass:"table",attrs:{data:e.tableData,border:""}},[t("el-table-column",{attrs:{type:"index",width:"50",label:"序号",index:e.indexMethod}}),t("el-table-column",{attrs:{prop:"taskName",label:"任务名称"}}),t("el-table-column",{attrs:{prop:"taskType",label:"任务类型"}}),t("el-table-column",{attrs:{prop:"taskStateName",label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-tag",{attrs:{type:i.row.stateType}},[e._v(e._s(i.row.taskStateName))])]}}])}),t("el-table-column",{attrs:{prop:"startTime",label:"开始时间",align:"center"}}),t("el-table-column",{attrs:{prop:"finishTime",label:"结束时间",align:"center"}}),t("el-table-column",{attrs:{prop:"",label:"操作",width:"220",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{disabled:0==i.row.taskState,type:"primary",size:"mini"},on:{click:function(t){return e.btnClick("stop",i.row)}}},[e._v("重新运行")]),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.btnClick("delete",i.row)}}},[e._v("删除")])]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"10px","text-align":"center"},attrs:{"current-page":e.currentPage,"page-sizes":[10,20],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e.dialogVisible?t("el-dialog",{attrs:{title:"新增",width:"800px",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("formEdit",{on:{handleClose:e.handleClose}})],1):e._e()],1)},a=[],l=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"form-contain"},[t("el-form",{ref:"form",attrs:{model:e.formInline,rules:e.formRules,"label-width":"180px"}},[t("el-form-item",{attrs:{label:"文件地址",prop:"csvPath"}},[t("el-input",{attrs:{placeholder:"请输入文件地址"},model:{value:e.formInline.csvPath,callback:function(t){e.$set(e.formInline,"csvPath",t)},expression:"formInline.csvPath"}})],1),t("el-form-item",{attrs:{label:"索引名",prop:"indexName"}},[t("el-select",{attrs:{placeholder:"请选择索引名"},model:{value:e.formInline.indexName,callback:function(t){e.$set(e.formInline,"indexName",t)},expression:"formInline.indexName"}},e._l(e.selectData,(function(e,i){return t("el-option",{key:e+i,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"分隔符",prop:"splitWord"}},[t("el-input",{attrs:{placeholder:"请输入分隔符"},model:{value:e.formInline.splitWord,callback:function(t){e.$set(e.formInline,"splitWord",t)},expression:"formInline.splitWord"}})],1),t("el-form-item",{attrs:{label:"是否自定义标头",prop:"isCustomTitle"}},[t("el-radio-group",{model:{value:e.formInline.isCustomTitle,callback:function(t){e.$set(e.formInline,"isCustomTitle",t)},expression:"formInline.isCustomTitle"}},[t("el-radio",{attrs:{label:!0}},[e._v("是")]),t("el-radio",{attrs:{label:!1}},[e._v("否")])],1),t("el-table",{directives:[{name:"show",rawName:"v-show",value:e.formInline.isCustomTitle,expression:"formInline.isCustomTitle"}],staticClass:"contain-table",staticStyle:{"min-width":"400px"},attrs:{data:e.titleData,height:"150px",border:"","header-cell-style":e.tableHeaderStyle}},[t("el-table-column",{attrs:{align:"center",label:"标头",prop:"name"}}),e._l(e.titles,(function(i,s){return t("el-table-column",{key:i+s,attrs:{prop:i,width:"120px"}},[t("template",{slot:"header"},[t("el-input",{attrs:{"validate-event":"",size:"mini",placeholder:"输入标头"},model:{value:e.titleForm[i],callback:function(t){e.$set(e.titleForm,i,t)},expression:"titleForm[item]"}})],1)],2)}))],2)],1),t("el-form-item",{attrs:{label:"csv文件首行是否有标头",prop:"isHasTitle"}},[t("el-radio-group",{model:{value:e.formInline.isHasTitle,callback:function(t){e.$set(e.formInline,"isHasTitle",t)},expression:"formInline.isHasTitle"}},[t("el-radio",{attrs:{label:!0}},[e._v("是")]),t("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1),t("el-form-item",{attrs:{label:"是否开启标题汉字转拼音",prop:"isTitleHasCh"}},[t("el-radio-group",{model:{value:e.formInline.isTitleHasCh,callback:function(t){e.$set(e.formInline,"isTitleHasCh",t)},expression:"formInline.isTitleHasCh"}},[t("el-radio",{attrs:{label:!0}},[e._v("是")]),t("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1),t("el-form-item",{attrs:{label:"解析模式",prop:"trans"}},[t("el-select",{attrs:{placeholder:"请选择解析模式"},model:{value:e.formInline.trans,callback:function(t){e.$set(e.formInline,"trans",t)},expression:"formInline.trans"}},[t("el-option",{attrs:{label:"解析所有文件",value:"1"}}),t("el-option",{attrs:{label:"解析单层文件",value:"2"}}),t("el-option",{attrs:{label:"解析单个文件",value:"3"}})],1)],1),t("el-form-item",{staticStyle:{"text-align":"center"}},[t("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.onSubmit}},[e._v("解析")]),t("el-button",{attrs:{size:"medium"},on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)])},r=[],n=(i(560),i(6557)),o=i(2168),u={data(){return{formInline:{isCustomTitle:!1,title:[],isHasTitle:!0,isTitleHasCh:!0},formRules:{csvPath:[{required:!0,message:"请输入文件地址",trigger:"blur"}],indexName:[{required:!0,message:"请选择索引",trigger:"blur"}],trans:[{required:!0,message:"请选择解析模式",trigger:"blur"}],isCustomTitle:[{required:!0,message:"请选择是否自定义标题",trigger:"blur"}],isHasTitle:[{required:!0,message:"请选择csv文件首行是否有标题",trigger:"blur"}],isTitleHasCh:[{required:!0,message:"请选择是否开启标题汉字转拼音",trigger:"blur"}],splitWord:[{required:!0,message:"请输入分隔符",trigger:"blur"}],title:[{required:!0,message:"请输入自定义文件头内容",trigger:"blur"}]},titles:[],titleData:[{}],selectData:[],titleForm:{},fileList:[]}},created(){(0,n.ip)().then((e=>{const{responseCode:t,data:i}=e;200==t&&(this.selectData=i)}))},mounted(){},watch:{"formInline.isCustomTitle":{handler:function(e){console.log(e,"newValue"),e&&(this.titleData=[{}],this.titles=[],this.formInline.csvPath&&this.formInline.splitWord?(0,n.jG)({filePath:this.formInline.csvPath,splitWord:this.formInline.splitWord}).then((e=>{const{data:t,responseCode:i,responseMsg:s}=e;if(200==i){this.$message.success(s);for(let e=0;e<t.length;e++)this.titles.push("names"+e);for(let e=0;e<t.length;e++){let i=this.titles[e];this.titleData[0][i]=t[e]}this.titleData[0].name="数据预览"}else this.$message.error(s)})):(this.formInline.isCustomTitle=!1,this.$message.warning("请输入文件地址或分隔符！")))}}},methods:{onSubmit(){this.$refs.form.validate((e=>{if(!e)return console.log("error submit!!"),!1;{let e=JSON.parse(JSON.stringify(this.formInline));for(let i in this.titleForm)e.title.push(this.titleForm[i]);let t="";switch(e.trans){case"1":t=n.Vb;break;case"2":t=n.HI;break;case"3":t=n.TB;break}delete e.trans,t(e).then((e=>{const{responseCode:t,responseMsg:i}=e;200==t?(this.$emit("handleClose"),this.$message.success(i)):this.$message.error(i)}))}}))},tableHeaderStyle({row:e,column:t,rowIndex:i}){if(0===i)return"padding:0px"},cancel(){this.$emit("handleClose")},httpRequest(e){console.log(e,"file"),(0,o.dC)({path:"/image",file:e.file}).then((e=>{console.log(e)}))},handlerChange(e,t){this.fileList=t}}},c=u,m=i(1001),d=(0,m.Z)(c,l,r,!1,null,"09e1eec2",null),h=d.exports,f={components:{formEdit:h},data(){return{tableData:[],indexMethod:1,loading:!0,total:0,currentPage:1,pageSize:20,dialogVisible:!1}},created(){this.getInfo()},methods:{handleSizeChange(e){this.pageSize=e},handleCurrentChange(e){this.currentPage=e},btnClick(e,t){switch(e){case"add":this.dialogVisible=!0;break;case"stop":this.runInfo(t.id);break;case"delete":this.deleteInfo(t.id);break}},runInfo(e){this.$confirm("此操作将重新运行, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.loading=!0,(0,n.RR)({id:e}).then((e=>{const{responseCode:t,responseMsg:i}=e;200==t?(this.loading=!1,this.$message.success(i),this.getInfo()):this.$message.error(i)}))})).catch((()=>{this.$message({type:"info",message:"已取消重新运行"})}))},deleteInfo(e){this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.loading=!0,(0,n.VK)({id:e}).then((e=>{const{responseCode:t,responseMsg:i}=e;200==t?(this.loading=!1,this.$message.success(i),this.getInfo()):this.$message.error(i)}))})).catch((()=>{this.$message({type:"info",message:"已取消删除"})}))},getInfo(){let e={pageNum:this.currentPage,pageSize:this.pageSize};(0,n.go)(e).then((e=>{this.loading=!1;const{data:t,responseCode:i}=e;200==i&&(this.total=t.total,t.list.forEach((e=>{switch(e.startTime=this.getTime(e.startTime),e.finishTime=e.finishTime?this.getTime(e.finishTime):"——",e.taskState){case 0:e["stateType"]="warning";break;case 1:e["stateType"]="success";break;case 2:e["stateType"]="danger";break}})),this.tableData=t.list)})).catch((e=>{console.log(e,"rr"),this.loading=!1,this.$message.error("网络错误,请稍后重试!")}))},handleClose(){this.dialogVisible=!1,this.getInfo()},getTime(e){let t=new Date(e);var i=t.getFullYear(),s=t.getMonth()+1,a=t.getDate(),l=t.getHours(),r=t.getMinutes(),n=t.getSeconds();return i+"-"+s+"-"+a+" "+l+":"+r+":"+n}}},p=f,g=(0,m.Z)(p,s,a,!1,null,"70ac8f7a",null),b=g.exports},6557:function(e,t,i){i.d(t,{HI:function(){return l},RR:function(){return m},TB:function(){return a},VK:function(){return c},Vb:function(){return r},go:function(){return u},ip:function(){return n},jG:function(){return o}});var s=i(4471);function a(e){return(0,s.Z)({url:"dataTrans/csvTransBulk",method:"POST",data:e})}function l(e){return(0,s.Z)({url:"dataTrans/csvFoldToEs",method:"POST",data:e})}function r(e){return(0,s.Z)({url:"dataTrans/csvDeepFoldToEs",method:"POST",data:e})}function n(){return(0,s.Z)({url:"/index/listAllIndices",method:"get"})}function o(e){return(0,s.Z)({url:"dataTrans/csvLine",method:"POST",params:e})}function u(e){return(0,s.Z)({url:"task/getAll",method:"get",params:e})}function c(e){return(0,s.Z)({url:"/task/delete",method:"delete",params:e})}function m(e){return(0,s.Z)({url:"task/rerun",method:"post",params:e})}},2168:function(e,t,i){i.d(t,{QU:function(){return a},dC:function(){return l},gJ:function(){return r},xl:function(){return n}});var s=i(4471);function a(e){return(0,s.Z)({url:"hdfs/getHdfsCatalog",method:"get",params:e})}function l(e){return(0,s.Z)({url:"hdfs/uploadFilesToHdfs",method:"get",params:e})}function r(e){return(0,s.Z)({url:"hdfs/createHdfsDirectory",method:"get",params:e})}function n(e){return(0,s.Z)({url:"hdfs/deleteHdfsPath",method:"get",params:e})}}}]);